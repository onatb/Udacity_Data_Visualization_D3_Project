<!DOCTYPE html>
<html>

  <head>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <style>
      h1 {
        text-align: center;
        font-family: 'Courgette', sans-serif;
        font-size: 26px;
      }
      .mid-percent {
        text-align: center;
        font-family: 'Courgette', sans-serif;
        font-size: 20px;
        font-weight: bold; 
      }
      .text-hover {
        text-align: center;
        font-family: 'Courgette', sans-serif;
        font-size: 12px;
        fill: grey;
      }
      #chart {
        text-align: center;
      }
      .listArc {
        fill: white;
        stroke: #AAAAAA;
      }
      .listText {
        fill: #6B6B6B;
        font-size: 11px;
        font-family: 'Courgette', sans-serif;
      }
    </style>

  </head>

  <body>

    <h1>Titanic Survivors</h1>

    <div id="chart"></div>

    <script type="text/javascript">

      var screenWidth = window.innerWidth;

      var margin = {
          left: 20,
          top: 20,
          right: 20,
          bottom: 20
        },
        width = Math.min(screenWidth, 500) - margin.left - margin.right,
        height = Math.min(screenWidth, 500) - margin.top - margin.bottom;

      var svg = d3.select("#chart").append("svg")
        .attr("width", (width + margin.left + margin.right))
        .attr("height", (height + margin.top + margin.bottom))
        .append("g").attr("class", "wrapper")
        .attr("transform", "translate(" + (width / 2 + margin.left) + "," + (height / 2 + margin.top) + ")");


      var limbo = [{
        id: 0,
        disp: "Best",
        values: {sex: "female", pclass: 1},
        desc_hover: "",
        desc_click: "",
        color_hover: "#FFFF82", 
        color_click: "#FFFF58",
        clicked: 0
      }, {
        id: 1,
        disp: "Female",
        values: {sex: "female"},
        desc_hover: "Female Passengers",
        desc_click: "",
        color_hover: "#FFC387", 
        color_click: "#FF9B39",
        clicked: 0
      }, {
        id: 2,
        disp: "Male",
        values: {sex: "male"},
        desc_hover: "Male Passengers",
        desc_click: "",
        color_hover: "#FFC387", 
        color_click: "#FF9B39",
        clicked: 0
      }, {
        id: 3,
        disp: "Class 1",
        values: {pclass: 1},
        desc_hover: "1st Class Passengers",
        desc_click: "",
        color_hover: "#F1DBF5", 
        color_click: "#D8AADF",
        clicked: 0
      }, {
        id: 4,
        disp: "Class 2",
        values: {pclass: 2},
        desc_hover: "2nd Class Passengers",
        desc_click: "",
        color_hover: "#F1DBF5",
        color_click: "#D8AADF",
        clicked: 0
      }, {
        id: 5,
        disp: "Class 3",
        values: {pclass: 3},
        desc_hover: "3rd Class Passengers",
        desc_click: "",
        color_hover: "#F1DBF5",
        color_click: "#D8AADF",
        clicked: 0
      }, {
        id: 6,
        disp: "0-21",
        values: {age: [0,21]},
        desc_hover: "Passengers below 21 years old",
        desc_click: "",
        color_hover: "#AAE3A7", 
        color_click: "#7BCE77",
        clicked: 0
      }, {
        id: 7,
        disp: "22-28",
        values: {age: [22,28]},
        desc_hover: "Passengers between 22-28 years old",
        desc_click: "",
        color_hover: "#AAE3A7", 
        color_click: "#7BCE77",
        clicked: 0
      }, {
        id: 8,
        disp: "29-39",
        values: {age: [29,39]},
        desc_hover: "Passengers between 29-39 years old",
        desc_click: "",
        color_hover: "#AAE3A7", 
        color_click: "#7BCE77",
        clicked: 0
      }, {
        id: 9,
        disp: "40-80",
        values: {age: [40,80]},
        desc_hover: "Passengers between 40-80 years old",
        desc_click: "",
        color_hover: "#AAE3A7", 
        color_click: "#7BCE77",
        clicked: 0
      }, {
        id: 10,
        disp: "No SibSp ",
        values: {sibsp: 0},
        desc_hover: "No siblings or spouse aboard",
        desc_click: "",
        color_hover: "#B1D3F0", 
        color_click: "#5796CA",
        clicked: 0
      }, {
        id: 11,
        disp: "1 SibSp",
        values: {sibsp: 1},
        desc_hover: "Sibling or spouse aboard",
        desc_click: "",
        color_hover: "#B1D3F0", 
        color_click: "#5796CA",
        clicked: 0
      }, {
        id: 12,
        disp: "2+ SibSp",
        values: {sibsp: 2},
        desc_hover: "Both sibling(s) and spouse aboard",
        desc_click: "",
        color_hover: "#B1D3F0", 
        color_click: "#5796CA",
        clicked: 0
      }, {
        id: 13,
        disp: "No ParCh",
        values: {parch: 0},
        desc_hover: "No parent or children aboard",
        desc_click: "",
        color_hover: "#FF9A9A", 
        color_click: "#F04949",
        clicked: 0
      }, {
        id: 14,
        disp: "1 ParCh",
        values: {parch: 1},
        desc_hover: "1 parent or children aboard",
        desc_click: "",
        color_hover: "#FF9A9A", 
        color_click: "#F04949",
        clicked: 0
      }, {
        id: 15,
        disp: "2+ ParCh",
        values: {parch: 2},
        desc_hover: "2 or more parent(s) or children(s) aboard",
        desc_click: "",
        color_hover: "#FF9A9A", 
        color_click: "#F04949",
        clicked: 0
      }];

      var arc = d3.svg.arc()
        .innerRadius(width * 0.9 / 2)
        .outerRadius(width * 0.9 / 2 + 30);

      var pie = d3.layout.pie()
        .value(function(d) {
          return 30;
        })
        .padAngle(.01)
        .sort(null);

      svg.selectAll(".listArc")
        .data(pie(limbo))
        .enter().append("path")
        .attr("class", "listArc")
        .attr("id", function(d, i) {
          return "listArc_" + i;
        })
        .attr("d", arc)
        .on("mouseover", function(d) {
          if(d.data.clicked === 0) {
            d3.select(this).style("fill", d.data.color_hover);
            svg.append("text")
              .attr("class", "text-hover")
              .attr("text-anchor", "middle")
              .attr("dy", 95)
              .text(d.data.desc_hover);
          }
        })
        .on("mouseout", function(d) {
          if (d.data.clicked === 0) {
            d3.select(this).style("fill", "white");
            d3.select(".text-hover").remove();
          }
        })
        .on("click", function(d) {
          if(d.data.clicked === 0) {
            d.data.clicked = 1;
            d3.select(this)
              .style("fill", d.data.color_click);
            d3.select(".text-hover").remove();
          } else
            d.data.clicked = 0;
        });


      svg.selectAll(".listText")
        .data(limbo)
        .enter().append("text")
        .attr("class", "listText")
        .attr("x", 11) //Move the text from the start angle of the arc
        .attr("dy", 18) //Move the text down
        .append("textPath")
        .attr("xlink:href", function(d, i) {
          return "#listArc_" + i;
        })
        .text(function(d) {
          return d.disp;
        })
        .on("mouseover", function(d) {
          if(d.clicked === 0) {
            d3.select(d3.select(this).attr("href")).style("fill", d.color_hover);
            svg.append("text")
              .attr("class", "text-hover")
              .attr("text-anchor", "middle")
              .attr("dy", 95)
              .text(d.desc_hover);
          }
        })
        .on("mouseout", function(d) {
          if (d.clicked === 0) {
            d3.select(d3.select(this).attr("href")).style("fill", "white");
            d3.select(".text-hover").remove();
          }
        })
        .on("click", function(d) {
          if(d.clicked === 0) {
            d.clicked = 1;
            d3.select(d3.select(this).attr("href"))
              .style("fill", d.color_click);
            d3.select(".text-hover").remove();
          } else
            d.clicked = 0;
          debugger;
        });

    </script>


  </body>

</html>


